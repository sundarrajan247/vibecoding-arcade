<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Tic Tac Toe • Vibecoding Arcade</title>
  <style>
    :root{--bg:#0b1020;--card:#121935;--text:#e7ecff;--accent:#9ad1ff}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Arial;background:var(--bg);color:var(--text);display:grid;place-items:center;min-height:100vh}
    .panel{background:var(--card);border:1px solid #1d2750;border-radius:18px;padding:18px;text-align:center}
    h1{margin:0;font-size:22px}
    .mode{margin:6px 0 12px;font-size:14px}
    .mode label{margin:0 6px;cursor:pointer}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin:10px 0}
    .board{display:grid;grid-template-columns:repeat(3,80px);grid-template-rows:repeat(3,80px);gap:8px;margin:12px auto}
    .board button{width:80px;height:80px;border-radius:12px;border:1px solid #29408a;background:#17224a;color:var(--text);font-size:36px;cursor:pointer}
    .board button.win{background:#2a3d7a}
    .board.busy{pointer-events:none;opacity:.7}
    .board button:focus{outline:2px solid var(--accent)}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid #29408a;background:#17224a;color:var(--text);cursor:pointer;text-decoration:none;display:inline-block}
    .btn:hover{background:#192656}
  </style>
</head>
<body>
  <div class="panel">
    <h1>❌⭕ Tic Tac Toe</h1>
    <div class="mode" aria-label="Game Mode">Mode:
      <label><input type="radio" name="mode" value="pvp" checked>2-Player</label>
      <label><input type="radio" name="mode" value="cpu">vs Computer</label>
    </div>
    <div class="row">
      <div>X: <span id="scoreX">0</span></div>
      <div>O: <span id="scoreO">0</span></div>
    </div>
    <div id="status">X's turn</div>
    <div id="board" class="board" role="grid" aria-label="Tic Tac Toe Board">
      <button data-idx="0" aria-label="Row 1 column 1"></button>
      <button data-idx="1" aria-label="Row 1 column 2"></button>
      <button data-idx="2" aria-label="Row 1 column 3"></button>
      <button data-idx="3" aria-label="Row 2 column 1"></button>
      <button data-idx="4" aria-label="Row 2 column 2"></button>
      <button data-idx="5" aria-label="Row 2 column 3"></button>
      <button data-idx="6" aria-label="Row 3 column 1"></button>
      <button data-idx="7" aria-label="Row 3 column 2"></button>
      <button data-idx="8" aria-label="Row 3 column 3"></button>
    </div>
    <div class="row">
      <button id="new" class="btn">New Game</button>
      <a class="btn" href="./index.html">Back</a>
    </div>
  </div>
<script>
(()=>{
  const boardEl=document.getElementById('board');
  const statusEl=document.getElementById('status');
  const newBtn=document.getElementById('new');
  const scoreXEl=document.getElementById('scoreX');
  const scoreOEl=document.getElementById('scoreO');
  const modeEls=document.querySelectorAll('input[name="mode"]');

  const state={
    board:Array(9).fill(''),
    current:'X',
    mode:'pvp',
    scores:{
      X:+localStorage.getItem('ttt_x')||0,
      O:+localStorage.getItem('ttt_o')||0
    }
  };
  scoreXEl.textContent=state.scores.X;
  scoreOEl.textContent=state.scores.O;

  function render(){
    boardEl.querySelectorAll('button').forEach((b,i)=>{
      b.textContent=state.board[i];
      b.classList.remove('win');
      b.disabled=!!state.board[i]||isComputerTurn();
    });
  }

  function getEmptyCells(b=state.board){ // [AI MODE]
    return b.map((v,i)=>v?null:i).filter(i=>i!==null);
  }

  function checkWinner(b=state.board){ // [AI MODE]
    const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(const [a,c,d] of wins){ if(b[a]&&b[a]===b[c]&&b[a]===b[d]) return {player:b[a],combo:[a,c,d]}; }
    return null;
  }

  function isGameOver(){ // [AI MODE]
    return checkWinner() || getEmptyCells().length===0;
  }

  function isComputerTurn(){ // [AI MODE]
    return state.mode==='cpu' && state.current==='O';
  }

  function updateStatus(){
    const win=checkWinner();
    if(win){
      statusEl.textContent=`${win.player} wins!`;
      win.combo.forEach(i=>boardEl.children[i].classList.add('win'));
    } else if(!getEmptyCells().length){
      statusEl.textContent='Draw';
    } else if(isComputerTurn()){
      statusEl.textContent='Computer thinking…';
    } else {
      statusEl.textContent=`${state.current}'s turn`;
    }
  }

  function handleMove(idx){
    if(state.board[idx]||isComputerTurn()) return;
    state.board[idx]=state.current;
    state.current=state.current==='X'?'O':'X';
    render();
    if(isGameOver()) endGame();
    else if(isComputerTurn()) scheduleComputerTurn();
    updateStatus();
  }

  function endGame(){
    const win=checkWinner();
    if(win){
      state.scores[win.player]++;
      localStorage.setItem(`ttt_${win.player.toLowerCase()}`,state.scores[win.player]);
      scoreXEl.textContent=state.scores.X;
      scoreOEl.textContent=state.scores.O;
    }
    boardEl.querySelectorAll('button').forEach(b=>b.disabled=true);
    updateStatus();
  }

  function resetBoard(){
    state.board.fill('');
    state.current='X';
    render();
    updateStatus();
  }

  function scheduleComputerTurn(){ // [AI MODE]
    boardEl.classList.add('busy');
    const delay=300+Math.random()*150;
    setTimeout(()=>{ computerMove(); boardEl.classList.remove('busy'); },delay);
  }

  function computerMove(){ // [AI MODE]
    const [r,c]=bestMove(state.board);
    const idx=r*3+c;
    state.board[idx]='O';
    state.current='X';
    render();
    if(isGameOver()) endGame();
    updateStatus();
  }

  function bestMove(board){ // [AI MODE]
    const order=[4,0,2,6,8,1,3,5,7];
    let best=Infinity,move=4;
    for(const i of order){
      if(board[i]) continue;
      board[i]='O';
      const score=minimax(board,0,true); // next is X
      board[i]='';
      if(score<best){ best=score; move=i; }
    }
    return [Math.floor(move/3), move%3];
  }

  function minimax(board,depth,isMax){ // [AI MODE]
    const win=checkWinner(board);
    if(win) return win.player==='X'?10-depth:depth-10;
    const empties=getEmptyCells(board);
    if(!empties.length) return 0;
    if(isMax){
      let best=-Infinity;
      for(const i of empties){
        board[i]='X';
        best=Math.max(best,minimax(board,depth+1,false));
        board[i]='';
      }
      return best;
    } else {
      let best=Infinity;
      for(const i of empties){
        board[i]='O';
        best=Math.min(best,minimax(board,depth+1,true));
        board[i]='';
      }
      return best;
    }
  }

  boardEl.addEventListener('click',e=>{
    if(e.target.matches('button')) handleMove(+e.target.dataset.idx);
  });

  newBtn.onclick=resetBoard;

  modeEls.forEach(r=>r.addEventListener('change',()=>{
    state.mode=document.querySelector('input[name="mode"]:checked').value;
    render();
    if(isComputerTurn()&&!isGameOver()) scheduleComputerTurn();
    updateStatus();
  }));

  render();
  updateStatus();
})();
</script>
</body>
</html>
